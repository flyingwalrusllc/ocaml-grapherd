language: c
sudo: false

cache:
  directories:
    - $HOME/.opam
    - $HOME/ocaml

install: bash -ex .travis-ci.sh prepare
script: bash -ex .travis-ci.sh build

matrix:
  include:
    - os: linux
      env: OCAML_VERSION=4.07 OCAML_RELEASE=1 WITH_OPAM=0
      stage: Build
    - os: osx
      env: OCAML_VERSION=4.07 OCAML_RELEASE=1 WITH_OPAM=0
      stage: Build_macOS
    - os: linux
      env: OCAML_VERSION=4.07 OCAML_RELEASE=1 WITH_OPAM=1
      stage: Test
      addons:
        apt:
          packages:
            - aspcud
      
